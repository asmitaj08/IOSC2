<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>TRENDNET | modelName Utility </title>
<link rel="stylesheet" href="style.css" type="text/css">
<script language="JavaScript" src="uk.js"></script>

<script language="JavaScript" src="public_js/public.js"></script>
<script language="Javascript" src="js/jquery-1.3.2.min.js"></script>
<script language="Javascript" src="js/xml.js"></script>
<script language="Javascript" src="js/object.js"></script>
<SCRIPT LANGUAGE="JavaScript">
	var dev_info = get_router_info();
	
	var xmlhttp;
	var delay_count = 12;  //for updating nvram value 
	
	function do_count_down(){
		get_by_id("timeleft").innerHTML = count;
		
		if (count == 0) {	       
	        //back();
	        return false;
	    }

		if (count > 0) {
	        count--;
	        setTimeout('do_count_down()',1000);
	    }
	
	}

	function do_delay_count_down(){				
		if (delay_count == 0) {	       
	        window.location.href = get_by_id("html_response_page").value;	        
	    }

		if (delay_count > 0) {
	        delay_count--;
	        setTimeout('do_delay_count_down()',1000);
	    }
		
	}

	function back(){
		var login_who=dev_info.login_info;
		if(login_who!= "w"){
			window.location.href ="status.htm";
		}else{
			window.location.href = get_by_id("html_response_page").value;
		}
		
	}
	
	/************************************************/
	/* send xml cgi for getting device dynamic info */
	/************************************************/
	/*
	function get_xml_of_wps_conn() {
		xmlhttp = createRequest(); 
		if(xmlhttp){
			var url;
			var lan_ip="<% CmoGetCfg("lan_ipaddr","none"); %>";
			var temp_cURL = document.URL.split("/");
			var mURL = temp_cURL[2];
			if(mURL == lan_ip){
					url="http://"+lan_ip+"/device.xml=wps_conn_status";
			}else{
					url="http://"+mURL+"/device.xml=wps_conn_status";
			}
			
		  xmlhttp.onreadystatechange = xmldoc; 
		  xmlhttp.open("GET", url, true); 
		  xmlhttp.send(null); 
		}
		setTimeout("get_xml_of_wps_conn()",5000);
	}	
	*/
	
	function query_wps_state()
	{
		var paramQueryWPSPIN={
			url: "get_set.ccp",
			arg: "ccp_act=queryWPSPin"
		}

		get_config_obj(paramQueryWPSPIN);
		
		var WPSPinRet = config_val("WPSPinRet");
		
		if((WPSPinRet == "success") && (count <=116))
		{
			paramQueryWPSPIN.arg = "ccp_act=doEvent&ccpSubEvent=CCP_SUB_WPSSUCCESS";
			get_config_obj(paramQueryWPSPIN);
			window.location.href = "wps_back_ok.htm";
			return;
		}
		else
		{
			paramQueryWPSPIN.arg = "ccp_act=doEvent&ccpSubEvent=CCP_SUB_WPSFAILURE";
			get_config_obj(paramQueryWPSPIN);
		}
		
		if(count == 0)
		{
			paramQueryWPSPIN.arg = "ccp_act=doEvent&ccpSubEvent=CCP_SUB_WPSTIMEOUT";
			get_config_obj(paramQueryWPSPIN);
			window.location.href = "wps_back_fail.htm";	
			return;
		}
		
		//count--;		
		//do_count_down();
		setTimeout('query_wps_state()',1000);
	}
	
	/*********************************************/
	/* parse xml response of device info to page */
	/*********************************************/
	/*
	function xmldoc(){ 
	  var result;
	  if (xmlhttp && xmlhttp.readyState == 4 && xmlhttp.status == 200) { 		
	    if(xmlhttp.responseXML.getElementsByTagName("wps_conn")[0]){		  	
	  	  result = xmlhttp.responseXML.getElementsByTagName("wps_conn")[0].firstChild.nodeValue;					
	  	  if(result == "1"){
	  	  	  // only do do_delay_count_down once 
	  	  	  if(delay_count == 12){
	  	  	  	do_delay_count_down();
	  	  	  	count = delay_count + 1;	
	  	  	  }
	  	  }
	  	}  	
	  }
	}*/	
</script>

</head>
<body>
<table width="750" border="0" cellpadding="0" cellspacing="0">
  <tr>
    <td width="21"><img src="c1_tl.gif" width="21" height="21" /></td>
    <td width="708" background="bg1_t.gif"><img src="top_1.gif" width="390" height="21" /></td>
    <td width="21"><img src="c1_tr.gif" width="21" height="21" /></td>
  </tr>
  <tr>
    <td valign="top" background="bg1_l.gif"><img src="top_2.gif" width="21" height="69" /></td>
    <td background="bg.gif"><table width="100%" border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td width="13%"><img src="logo.gif" /></td>
        <td width="87%" align="right"><img src="description.gif" /></td>
      </tr>
    </table>
        <table width="100%" border="0" cellpadding="0" cellspacing="0">
          <tr>
            <td width="78%" valign="top"><table width="98%" border="0" cellpadding="0" cellspacing="0" class="tabBigTitle">
                <tr>
                  <td class="headerbg2">&nbsp;</td>
                </tr>
                <tr>
                  <td valign="top"><form id="form2" name="form1" method="post">
                    <input type="hidden" id="html_response_page" name="html_response_page" value="wps_back_result.htm">
                    <input type="hidden" id="html_response_message" name="html_response_message" value='<% CmoGetCfg("html_response_message","none"); %>'>
                    <input type="hidden" id="html_response_return_page" name="html_response_return_page" value='<% CmoGetCfg("html_response_return_page","none"); %>'>
                    <input type="hidden" name="reboot_type" value="none">
                    <TABLE width="98%" height="200" border="0" align="center" cellpadding="3" cellspacing="1">
                      <tr>
                        <td bgcolor="#DDDDDD"><table width="70%" border="0" align="center">
                            <tr>
                              <td height="100"><div id=box_header3>
                                  <div align="left">
                                    <p align="center"> <script>show_words('li_msg7');</script> <span id="timeleft"></span>&nbsp;<script>show_words('li_msg3');</script> </p>
                                  </div>
                              </div></td>
                            </tr>
                        </table></td>
                      </tr>
                    </table>
                  </form>
                    <br></td>
                </tr>
              </table>
                <br></td>
          </tr>
      </table></td>
    <td background="bg1_r.gif">&nbsp;</td>
  </tr>
  <tr>
    <td><img src="c1_bl.gif" width="21" height="20" /></td>
    <td align="right" background="bg1_b.gif"><img src="copyright.png" width="264" height="20" /></td>
    <td><img src="c1_br.gif" width="21" height="20" /></td>
  </tr>
</table>
</body>
<script>
	var count = 120;
	do_count_down();
	query_wps_state();
	//get_xml_of_wps_conn();	
</script>
</html>
